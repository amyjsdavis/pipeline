---
title: "Process occurrences"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load libraries

```{r}
library(rgbif)
library(trias)
```

## Download GBIF occurrences

### For species of EU concern

```{r}
input_checklist <- "../data/input/eu_concern_species.tsv"
eu_concern_species <- read.table(file = input_checklist, header = TRUE, sep = "\t")
taxonKeys <- eu_concern_species["gbif_taxonKey"]
countries <- list(country = c("BE"))
body <- trias::predicates(
  taxonKey = taxonKeys, countries = countries, creator = NULL, 
  notification_address = NULL)
gbif_download_key <- rgbif::occ_download(body = body, curlopts = list(verbose = TRUE))
```

Check status of download:

```{r}
metadata <- occ_download_meta(key = gbif_download_key)
```

Write download to list of downloads and check pending downloads

```{r}
setwd('..')
trias::update_download_list(file = paste0(getwd(),"/data/output/gbif_downloads.csv"), 
                            download_to_add = gbif_download_key, 
                            input_checklist = input_checklist, countries = countries)
```
